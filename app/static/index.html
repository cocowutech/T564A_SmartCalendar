<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Calendar Agent</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="app-shell">
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">Smart Calendar</h1>
                <span class="term-label">Fall 2025</span>
            </div>
            <div class="header-actions">
                <!-- View Switcher -->
                <div class="view-toggle" style="display: flex; gap: 0.5rem; margin-right: 1rem;">
                    <button class="btn btn-secondary view-btn active" id="gridViewBtn" onclick="switchView('grid')">
                        <span class="icon">üìÖ</span> Grid View
                    </button>
                    <button class="btn btn-secondary view-btn" id="simpleViewBtn" onclick="switchView('simple')">
                        <span class="icon">üìù</span> Simple View
                    </button>
                </div>
                <button class="btn btn-secondary" onclick="loadRealEvents()">
                    <span class="icon">üîÑ</span> Refresh
                </button>
                <button class="btn btn-light" onclick="printWeeklyCalendar()">
                    <span class="icon">üñ®Ô∏è</span> Print / PDF
                </button>
                <button class="btn btn-light" onclick="downloadWeekAsCSV()">
                    <span class="icon">üì•</span> Export Excel
                </button>
                <button class="btn btn-primary" onclick="showAddEventModal()">
                    <span class="icon">‚ûï</span> Add Activity
                </button>
            </div>
        </header>

        <div class="app-body">
            <aside class="control-panel">
                <!-- Course & Event Filters - Hidden per user request -->
                <section class="panel-card" style="display: none;">
                    <h2>Course & Event Filters</h2>
                    <div class="filter-actions">
                        <button class="btn-text" onclick="selectAllCourses(true)">All</button>
                        <button class="btn-text" onclick="selectAllCourses(false)">None</button>
                    </div>
                    <div class="filter-list" id="courseFilterList">
                        <!-- Dynamically populated with course checkboxes -->
                    </div>
                </section>

                <section class="panel-card">
                    <h2>Add Smart Activity</h2>
                    <p class="hint">Create structured recurring plans with natural language or form input.</p>
                    <div class="panel-field">
                        <label for="voiceInput">Describe your activity</label>
                        <div class="voice-inline">
                            <textarea id="voiceInput" placeholder="I want a 2 hour study session every Wednesday evening."></textarea>
                            <button id="micButton" class="mic-button" onclick="toggleVoiceRecognition()" title="Speak command">
                                <span id="micIcon">üé§</span>
                            </button>
                        </div>
                        <div id="voiceStatus" class="voice-status"></div>
                    </div>
                    <div class="voice-actions">
                        <button class="btn btn-primary btn-block" onclick="addRecurringEvent()">Generate Suggestions</button>
                    </div>
                    <div id="voiceResult" class="result"></div>
                </section>

                <!-- Batch Import - Hidden per user request -->
                <section class="panel-card" style="display: none;">
                    <h2>Batch Import Events</h2>
                    <p class="hint">Import multiple events from CSV/Excel file</p>
                    <div class="panel-field">
                        <label for="csvFileInput">Upload CSV/Excel File</label>
                        <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls" onchange="handleFileUpload(event)" style="margin-bottom: 0.5rem;">
                        <a href="/static/event_import_template.csv" download class="btn-text" style="font-size: 0.85rem;">Download Template</a>
                    </div>
                    <div class="panel-field">
                        <label for="batchEventsInput">Or Paste CSV Data</label>
                        <textarea id="batchEventsInput" placeholder="Paste CSV data here...&#10;title,date,start_time,end_time,location,description,all_day&#10;Meeting,2025-10-25,09:00,10:00,Room A,Team sync,false" rows="4"></textarea>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="importBatchEvents()">Import Events</button>
                    <div id="batchImportResult" class="result toast"></div>
                </section>

                <section class="panel-card">
                    <h2>Sync Sources</h2>
                    <button class="btn btn-success btn-block" onclick="syncAll()">
                        <span class="icon">üîÑ</span> Sync All Sources
                    </button>
                    <div class="sync-grid">
                        <button class="btn btn-light" onclick="refreshGoogleCalendar(event)">Google Calendar</button>
                        <button class="btn btn-light" onclick="ingestCanvas(event)">Canvas</button>
                        <!-- Gmail sync hidden per user request -->
                        <button class="btn btn-light" onclick="ingestOutlook(event)">Outlook Calendar</button>
                    </div>
                    <div class="auto-sync-panel">
                        <label class="toggle-label">
                            <input type="checkbox" id="autoSyncToggle" onchange="toggleAutoSync()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Auto-sync</span>
                        </label>
                        <select id="syncInterval" class="sync-interval" onchange="updateSyncInterval()" disabled>
                            <option value="5">Every 5 min</option>
                            <option value="15" selected>Every 15 min</option>
                            <option value="30">Every 30 min</option>
                            <option value="60">Every hour</option>
                        </select>
                        <div id="nextSync" class="next-sync">Auto-sync disabled</div>
                    </div>
                    <div id="ingestResult" class="result toast"></div>
                </section>

                <section class="panel-card status-card">
                    <h2>System Status</h2>
                    <ul class="status-list">
                        <li><span>API</span><span id="apiStatus">Checking‚Ä¶</span></li>
                        <li><span>Last Sync</span><span id="lastSync">Never</span></li>
                        <li><span>Auto-sync</span><span id="autoSyncStatus">‚ö´ Off</span></li>
                        <li><span>Voice</span><span id="voiceSupport">Checking...</span></li>
                    </ul>
                </section>
            </aside>

            <main class="calendar-section" id="gridCalendar">
                <div class="week-header">
                    <div class="week-nav">
                        <button class="nav-btn" onclick="changeWeek(-1)">‚Äπ</button>
                        <div class="week-range">
                            <h2 id="weekRange"></h2>
                            <span id="weekSubheading"></span>
                        </div>
                        <button class="nav-btn" onclick="changeWeek(1)">‚Ä∫</button>
                    </div>
                    <div class="week-meta">
                        <!-- Hidden per requirements -->
                    </div>
                </div>

                <!-- Week Grid with 30-min intervals -->
                <div class="weekly-calendar">
                    <div class="time-column" id="timeColumn"></div>
                    <div class="week-grid" id="weekGrid"></div>
                </div>
            </main>

            <!-- Simple Calendar View -->
            <main class="calendar-section simple-calendar-view" id="simpleCalendar" style="display: none;">
                <div class="simple-calendar-container">
                    <div class="simple-greeting" id="simpleGreeting">
                        <h2>Hi! üëã</h2>
                        <p id="simpleDate"></p>
                    </div>
                    <div class="simple-summary" id="simpleSummary">
                        <p>Loading your schedule...</p>
                    </div>
                    <div class="simple-events" id="simpleEventsList"></div>
                </div>
            </main>

            <aside class="insights-panel">
                <section class="panel-card schedule-card">
                    <h2 id="selectedDayTitle">Schedule for Today</h2>
                    <div id="selectedDayEvents" class="event-list"></div>
                </section>

                <section class="panel-card upcoming-card">
                    <h2>Upcoming</h2>
                    <div id="upcomingEvents" class="event-list"></div>
                </section>

                <!-- All-Day Events Section (in right panel) -->
                <section class="panel-card allday-card" id="allDayBanner" style="display: none;">
                    <div class="all-day-header">
                        <h2>üìå All-Day & No-Time Events</h2>
                        <div class="day-filter-dots" id="dayFilterDots">
                            <button class="day-dot active" data-day="0" onclick="filterAllDayByDay(0)" title="Monday">M</button>
                            <button class="day-dot active" data-day="1" onclick="filterAllDayByDay(1)" title="Tuesday">T</button>
                            <button class="day-dot active" data-day="2" onclick="filterAllDayByDay(2)" title="Wednesday">W</button>
                            <button class="day-dot active" data-day="3" onclick="filterAllDayByDay(3)" title="Thursday">T</button>
                            <button class="day-dot active" data-day="4" onclick="filterAllDayByDay(4)" title="Friday">F</button>
                            <button class="day-dot active" data-day="5" onclick="filterAllDayByDay(5)" title="Saturday">S</button>
                            <button class="day-dot active" data-day="6" onclick="filterAllDayByDay(6)" title="Sunday">S</button>
                        </div>
                    </div>
                    <div class="all-day-events" id="allDayEvents"></div>
                </section>
            </aside>
        </div>
    </div>

    <!-- Manual Add Event Modal -->
    <div class="modal" id="addEventModal" style="display: none;">
        <div class="modal-overlay" onclick="hideAddEventModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Add New Event</h2>
                <button class="modal-close" onclick="hideAddEventModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="eventTitle">Event Title *</label>
                    <input type="text" id="eventTitle" placeholder="e.g., Team Meeting" required>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="eventDate">Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-field">
                        <label>
                            <input type="checkbox" id="eventAllDay" onchange="toggleEventTime()"> All-day event
                        </label>
                    </div>
                </div>
                <div class="form-row" id="timeFields">
                    <div class="form-field">
                        <label for="eventStartTime">Start Time *</label>
                        <input type="time" id="eventStartTime" value="09:00">
                    </div>
                    <div class="form-field">
                        <label for="eventEndTime">End Time *</label>
                        <input type="time" id="eventEndTime" value="10:00">
                    </div>
                </div>
                <div class="form-field">
                    <label for="eventLocation">Location</label>
                    <input type="text" id="eventLocation" placeholder="e.g., Room 201 or Zoom">
                </div>
                <div class="form-field">
                    <label for="eventDescription">Description</label>
                    <textarea id="eventDescription" rows="3" placeholder="Additional details..."></textarea>
                </div>
                <div class="form-divider"></div>
                <div class="form-field repeat-toggle-row">
                    <label class="toggle-inline">
                        <input type="checkbox" id="eventRepeatToggle" onchange="toggleRepeatOptions(event)">
                        <span>Repeat this activity</span>
                    </label>
                    <p class="hint">Create recurring sessions and skip holidays or break weeks.</p>
                </div>
                <div class="repeat-options" id="repeatOptions" style="display: none;">
                    <div class="repeat-row">
                        <label>Repeat every</label>
                        <div class="repeat-frequency">
                            <input type="number" id="repeatInterval" min="1" value="1">
                            <select id="repeatFrequency">
                                <option value="weekly">week</option>
                                <option value="biweekly">2 weeks</option>
                                <option value="daily">day</option>
                                <option value="monthly">month</option>
                            </select>
                        </div>
                    </div>
                    <div class="repeat-row" id="repeatDayPickerRow">
                        <label>On</label>
                        <div class="repeat-day-picker" id="repeatDayPicker">
                            <button type="button" class="repeat-day-toggle" data-day="mon">Mon</button>
                            <button type="button" class="repeat-day-toggle" data-day="tue">Tue</button>
                            <button type="button" class="repeat-day-toggle" data-day="wed">Wed</button>
                            <button type="button" class="repeat-day-toggle" data-day="thu">Thu</button>
                            <button type="button" class="repeat-day-toggle" data-day="fri">Fri</button>
                            <button type="button" class="repeat-day-toggle" data-day="sat">Sat</button>
                            <button type="button" class="repeat-day-toggle" data-day="sun">Sun</button>
                        </div>
                    </div>
                    <div class="repeat-row">
                        <label>Until</label>
                        <div class="repeat-until">
                            <select id="repeatUntilType" onchange="handleRepeatUntilTypeChange()">
                                <option value="date">Specific date</option>
                                <option value="end_of_semester">End of semester</option>
                            </select>
                            <input type="date" id="repeatUntilDate">
                        </div>
                    </div>
                    <div class="repeat-row">
                        <label>Exceptions</label>
                        <div class="repeat-exceptions">
                            <div id="exceptionList" class="exception-chip-container" aria-live="polite"></div>
                            <div class="exception-controls">
                                <input type="date" id="exceptionStartDate" aria-label="Skip start date">
                                <input type="date" id="exceptionEndDate" aria-label="Skip end date (optional)">
                                <button type="button" class="btn btn-light" onclick="addManualException()">Skip</button>
                            </div>
                            <select id="exceptionPresetSelect" class="exception-presets" onchange="handleExceptionPresetChange(this.value)">
                                <option value="">Add holiday...</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideAddEventModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitManualEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <div class="modal" id="editEventModal" style="display: none;">
        <div class="modal-overlay" onclick="closeEditEventModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Activity</h2>
                <button class="modal-close" onclick="closeEditEventModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="editEventTitle">Title</label>
                    <input type="text" id="editEventTitle">
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="editEventDate">Date</label>
                        <input type="date" id="editEventDate" disabled>
                    </div>
                    <div class="form-field">
                        <label>Time</label>
                        <div class="time-range">
                            <input type="time" id="editEventStart">
                            <span class="time-separator">to</span>
                            <input type="time" id="editEventEnd">
                        </div>
                    </div>
                </div>
                <div class="form-field">
                    <label for="editEventLocation">Location</label>
                    <input type="text" id="editEventLocation" placeholder="Optional">
                </div>
                <div class="form-field">
                    <label for="editEventDescription">Description</label>
                    <textarea id="editEventDescription" rows="3" placeholder="Optional notes..."></textarea>
                </div>
                <div class="form-field">
                    <label>Apply changes to</label>
                    <div class="scope-options">
                        <label><input type="radio" name="editScope" value="single" checked> This event only</label>
                        <label><input type="radio" name="editScope" value="future"> This and future events</label>
                    </div>
                    <p class="hint">Future updates apply to every later session in this series.</p>
                    <p class="hint series-context" id="editSeriesContext" style="display: none;"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditEventModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitEditEvent()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
